<!DOCTYPE html>
<html lang="cs" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#0055ff" id="themeColorMeta">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="ProfesionÃ¡lnÃ­ sprÃ¡va vodÃ¡renskÃ½ch areÃ¡lÅ¯ s AI asistentem, GPS navigacÃ­ a pokroÄilou analytikou">
<meta name="keywords" content="vodÃ¡rny, management, AI, GPS, routing, optimalizace">
<meta name="author" content="Dominik Schmied">
<meta property="og:title" content="JVS Ultimate PRO | AI Management System">
<meta property="og:description" content="ProfesionÃ¡lnÃ­ sprÃ¡va vodÃ¡renskÃ½ch areÃ¡lÅ¯ s AI asistentem">
<meta property="og:type" content="website">
<meta property="og:url" content="https://dominik-88.github.io/FOREST/">
<meta property="og:image" content="https://dominik-88.github.io/FOREST/og-image.png">
<meta name="twitter:card" content="summary_large_image">
<title>JVS Ultimate PRO | AI Management System</title>
<link rel="canonical" href="https://dominik-88.github.io/FOREST/">
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%230055ff'/%3E%3Ctext x='50' y='55' font-size='50' fill='white' text-anchor='middle'%3EJ%3C/text%3E%3C/svg%3E">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css">
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<style>
:root[data-theme="light"]{--primary:#0055ff;--primary-dark:#0044cc;--accent:#7c3aed;--success:#10b981;--danger:#ef4444;--warning:#f59e0b;--secondary:#64748b;--bg:#f1f5f9;--bg-glass:rgba(255,255,255,0.95);--text-dark:#1e293b;--text-muted:#64748b;--border:#e2e8f0;--card-bg:#ffffff;}
:root[data-theme="dark"]{--primary:#4c8cff;--primary-dark:#3a7ae8;--accent:#a855f7;--success:#34d399;--danger:#f87171;--warning:#fbbf24;--secondary:#94a3b8;--bg:#0f172a;--bg-glass:rgba(15,23,42,0.95);--text-dark:#f1f5f9;--text-muted:#94a3b8;--border:#334155;--card-bg:#1e293b;}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'Inter',sans-serif;overflow:hidden;height:100vh;width:100vw;color:var(--text-dark);background:var(--bg);transition:background 0.3s,color 0.3s;}
#mapWrapper{position:fixed;top:0;left:0;right:0;bottom:0;z-index:0;}
#map{height:100%;width:100%;background:var(--bg);}
:root[data-theme="dark"] #map{filter:hue-rotate(180deg) invert(90%);}
.leaflet-popup-content-wrapper{background:var(--card-bg);color:var(--text-dark);border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
.leaflet-popup-tip{background:var(--card-bg);}
.fab{pointer-events:auto;position:fixed;width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:none;font-size:22px;box-shadow:0 10px 15px -3px rgb(0 0 0/0.1);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);z-index:1100;backdrop-filter:blur(16px);cursor:pointer;}
.fab:hover{transform:scale(1.1);}.fab:active{transform:scale(0.95);}
.menu-fab{top:20px;left:20px;background:var(--primary);color:white;}
.add-fab{top:20px;right:20px;background:var(--success);color:white;}
.add-fab.active{background:var(--danger);transform:rotate(45deg);}
.ai-fab{bottom:90px;right:20px;background:var(--accent);color:white;animation:pulse-ai 2s infinite;}
.gps-fab{bottom:160px;right:20px;background:var(--warning);color:white;}
.gps-fab.active{background:var(--success);animation:pulse-gps 1.5s infinite;}
.theme-fab{bottom:230px;right:20px;background:var(--secondary);color:white;}
.route-fab{bottom:300px;right:20px;background:var(--primary);color:white;}
@keyframes pulse-ai{0%,100%{box-shadow:0 0 0 0 rgba(124,58,237,0.7);}50%{box-shadow:0 0 0 15px rgba(124,58,237,0);}}
@keyframes pulse-gps{0%,100%{box-shadow:0 0 0 0 rgba(16,185,129,0.7);}50%{box-shadow:0 0 0 12px rgba(16,185,129,0);}}
.quick-stats{pointer-events:auto;position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--bg-glass);backdrop-filter:blur(16px);padding:14px 32px;border-radius:50px;box-shadow:0 10px 15px -3px rgb(0 0 0/0.1);display:flex;gap:28px;z-index:900;border:1px solid var(--border);}
.qs-item{display:flex;flex-direction:column;align-items:center;gap:4px;}
.qs-val{font-size:20px;font-weight:800;color:var(--primary);}
.qs-lbl{font-size:10px;color:var(--text-muted);font-weight:600;text-transform:uppercase;}
.sidebar{pointer-events:auto;position:fixed;top:0;left:0;bottom:0;width:420px;max-width:90vw;background:var(--bg-glass);backdrop-filter:blur(16px);box-shadow:10px 0 40px rgba(0,0,0,0.12);transform:translateX(-100%);transition:transform 0.4s cubic-bezier(0.4,0,0.2,1);z-index:1050;display:flex;flex-direction:column;border-right:1px solid var(--border);overflow-y:auto;}
.sidebar.active{transform:translateX(0);}
.sidebar-header{padding:28px 24px;background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;position:sticky;top:0;z-index:10;}
.brand-row{display:flex;justify-content:space-between;align-items:center;}
.app-brand{display:flex;align-items:center;gap:14px;}
.brand-icon{width:48px;height:48px;background:rgba(255,255,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:900;backdrop-filter:blur(10px);border:2px solid rgba(255,255,255,0.3);}
.brand-text h1{font-size:22px;font-weight:800;margin-bottom:2px;}
.brand-text p{font-size:11px;opacity:0.85;font-weight:500;}
.close-sidebar{background:rgba(255,255,255,0.15);border:none;color:white;width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;cursor:pointer;}
.close-sidebar:hover{background:rgba(255,255,255,0.25);}
.sidebar-content{overflow-y:auto;flex:1;padding:20px;}
.panel-section{background:var(--card-bg);border-radius:14px;margin-bottom:16px;border:1px solid var(--border);overflow:hidden;transition:all 0.3s;}
.panel-head{padding:18px 20px;font-weight:700;font-size:14px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;color:var(--text-dark);background:var(--bg);}
.panel-head:hover{opacity:0.8;}
.panel-head .chevron{transition:transform 0.3s;color:var(--text-muted);}
.panel-section.open .chevron{transform:rotate(180deg);}
.panel-body{max-height:0;overflow:hidden;opacity:0;transition:all 0.4s cubic-bezier(0.4,0,0.2,1);}
.panel-section.open .panel-body{max-height:5000px;padding:20px;opacity:1;}
.form-group{margin-bottom:16px;}
.form-label{display:block;font-size:11px;font-weight:700;color:var(--text-muted);margin-bottom:8px;text-transform:uppercase;}
.form-input,.form-select{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:14px;background:var(--bg);transition:all 0.3s;color:var(--text-dark);}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(0,85,255,0.08);}
.form-input.error{border-color:var(--danger);animation:shake 0.3s;}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}}
.error-msg{color:var(--danger);font-size:11px;margin-top:4px;display:none;}
.form-input.error + .error-msg{display:block;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 20px;border-radius:10px;border:none;font-weight:600;font-size:14px;transition:all 0.3s;width:100%;cursor:pointer;}
.btn-primary{background:var(--primary);color:white;}
.btn-primary:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,85,255,0.3);}
.btn-success{background:var(--success);color:white;}
.btn-danger{background:var(--danger);color:white;}
.btn-warning{background:var(--warning);color:white;}
.btn-accent{background:var(--accent);color:white;}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.stat-item{background:var(--bg);padding:16px;border-radius:12px;border:1px solid var(--border);text-align:center;}
.stat-val{font-size:24px;font-weight:800;color:var(--primary);display:block;}
.stat-lbl{font-size:10px;color:var(--text-muted);font-weight:600;text-transform:uppercase;}
.toast{position:fixed;top:80px;right:20px;background:var(--card-bg);padding:16px 24px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.2);display:flex;align-items:center;gap:12px;z-index:9999;animation:slideInRight 0.3s ease-out;max-width:400px;border:1px solid var(--border);}
@keyframes slideInRight{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}
.toast.success{border-left:4px solid var(--success);}
.toast.error{border-left:4px solid var(--danger);}
.toast.warning{border-left:4px solid var(--warning);}
.toast.info{border-left:4px solid var(--primary);}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);z-index:2000;display:none;align-items:center;justify-content:center;padding:20px;}
.modal.active{display:flex;}
.modal-card{background:var(--card-bg);border-radius:14px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 15px -3px rgb(0 0 0/0.1);}
.modal-header{padding:24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;}
.modal-title{font-size:20px;font-weight:800;color:var(--text-dark);}
.modal-close{background:none;border:none;font-size:28px;color:var(--text-muted);cursor:pointer;width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all 0.3s;}
.modal-close:hover{background:var(--bg);color:var(--danger);}
.modal-body{padding:24px;}
.route-list{display:flex;flex-direction:column;gap:8px;margin-top:12px;}
.route-item{background:var(--bg);padding:14px;border-radius:10px;display:flex;align-items:center;justify-content:space-between;gap:12px;border:1px solid var(--border);cursor:move;}
.route-item:hover{box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.route-num{width:32px;height:32px;background:var(--primary);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;flex-shrink:0;}
.route-info{flex:1;}
.route-name{font-weight:600;font-size:14px;color:var(--text-dark);}
.route-meta{font-size:11px;color:var(--text-muted);margin-top:2px;}
.route-actions{display:flex;gap:8px;}
.route-btn{width:32px;height:32px;border-radius:8px;border:none;background:var(--bg);color:var(--text-dark);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s;}
.route-btn:hover{background:var(--danger);color:white;}
.loading-spinner{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;animation:spin 0.8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.badge{display:inline-flex;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700;text-transform:uppercase;}
.badge-cat-1{background:#fee2e2;color:#991b1b;}
.badge-cat-2{background:#fef3c7;color:#92400e;}
.badge-cat-none{background:#f1f5f9;color:#475569;}
@media (max-width: 768px){
  .quick-stats{bottom:10px;padding:10px 20px;gap:16px;font-size:0.85em;}
  .qs-val{font-size:16px;}
  .fab{width:48px;height:48px;font-size:18px;}
  .theme-fab{bottom:170px;}
  .gps-fab{bottom:110px;}
  .route-fab{bottom:230px;}
}
</style>
</head>
<body>

<!-- Map -->
<div id="mapWrapper">
  <div id="map"></div>
</div>

<!-- FABs -->
<button class="fab menu-fab" onclick="toggleSidebar()" title="Menu"><i class="fas fa-bars"></i></button>
<button class="fab add-fab" onclick="toggleAddMode()" title="PÅ™idat areÃ¡l" id="addFab"><i class="fas fa-plus"></i></button>
<button class="fab ai-fab" onclick="openAIModal()" title="AI Protokol"><i class="fas fa-robot"></i></button>
<button class="fab gps-fab" onclick="locateUser()" title="Moje poloha" id="gpsFab"><i class="fas fa-crosshairs"></i></button>
<button class="fab theme-fab" onclick="toggleTheme()" title="PÅ™epnout tÃ©ma" id="themeFab"><i class="fas fa-moon"></i></button>
<button class="fab route-fab" onclick="openRouteModal()" title="PlÃ¡novÃ¡nÃ­ trasy"><i class="fas fa-route"></i></button>

<!-- Quick Stats -->
<div class="quick-stats">
  <div class="qs-item">
    <span class="qs-val" id="statsTotal">41</span>
    <span class="qs-lbl">AreÃ¡lÅ¯</span>
  </div>
  <div class="qs-item">
    <span class="qs-val" id="statsArea">0</span>
    <span class="qs-lbl">mÂ² celkem</span>
  </div>
  <div class="qs-item">
    <span class="qs-val" id="statsFence">0</span>
    <span class="qs-lbl">bm plotÅ¯</span>
  </div>
  <div class="qs-item">
    <span class="qs-val" id="statsRoute">0</span>
    <span class="qs-lbl">V trase</span>
  </div>
</div>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="brand-row">
      <div class="app-brand">
        <div class="brand-icon">J</div>
        <div class="brand-text">
          <h1>JVS Ultimate PRO</h1>
          <p>AI Management System v2.0</p>
        </div>
      </div>
      <button class="close-sidebar" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
    </div>
  </div>
  
  <div class="sidebar-content">
    
    <!-- Filtry -->
    <div class="panel-section open">
      <div class="panel-head" onclick="togglePanel(this)">
        <span><i class="fas fa-filter"></i> Filtry a vyhledÃ¡vÃ¡nÃ­</span>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label class="form-label">Vyhledat areÃ¡l</label>
          <input type="text" class="form-input" id="searchInput" placeholder="NÃ¡zev areÃ¡lu...">
        </div>
        <div class="form-group">
          <label class="form-label">Okres</label>
          <select class="form-select" id="districtFilter">
            <option value="">VÅ¡echny okresy</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Kategorie</label>
          <select class="form-select" id="categoryFilter">
            <option value="">VÅ¡echny kategorie</option>
            <option value="I.">I. (VysokÃ¡)</option>
            <option value="II.">II. (StÅ™ednÃ­)</option>
            <option value="none">Bez kategorie</option>
          </select>
        </div>
        <button class="btn btn-primary" onclick="resetFilters()"><i class="fas fa-redo"></i> Reset filtrÅ¯</button>
      </div>
    </div>
    
    <!-- Statistiky -->
    <div class="panel-section">
      <div class="panel-head" onclick="togglePanel(this)">
        <span><i class="fas fa-chart-bar"></i> Statistiky</span>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="panel-body">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-val" id="statTotalAreas">41</span>
            <span class="stat-lbl">Celkem areÃ¡lÅ¯</span>
          </div>
          <div class="stat-item">
            <span class="stat-val" id="statTotalArea">0</span>
            <span class="stat-lbl">mÂ² vÃ½mÄ›ra</span>
          </div>
          <div class="stat-item">
            <span class="stat-val" id="statTotalFence">0</span>
            <span class="stat-lbl">bm oplocenÃ­</span>
          </div>
          <div class="stat-item">
            <span class="stat-val" id="statFiltered">41</span>
            <span class="stat-lbl">FiltrovÃ¡no</span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Akce -->
    <div class="panel-section">
      <div class="panel-head" onclick="togglePanel(this)">
        <span><i class="fas fa-cog"></i> Akce</span>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="panel-body">
        <button class="btn btn-success" onclick="openRouteModal()" style="margin-bottom:12px;"><i class="fas fa-route"></i> PlÃ¡novÃ¡nÃ­ trasy</button>
        <button class="btn btn-accent" onclick="openAIModal()" style="margin-bottom:12px;"><i class="fas fa-robot"></i> AI Protokol</button>
        <button class="btn btn-primary" onclick="exportCSV()" style="margin-bottom:12px;"><i class="fas fa-download"></i> Export CSV</button>
        <button class="btn btn-warning" onclick="clearStorage()"><i class="fas fa-trash"></i> Vymazat data</button>
      </div>
    </div>
    
    <!-- O aplikaci -->
    <div class="panel-section">
      <div class="panel-head" onclick="togglePanel(this)">
        <span><i class="fas fa-info-circle"></i> O aplikaci</span>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="panel-body">
        <p style="font-size:13px;color:var(--text-muted);line-height:1.6;">
          <strong>JVS Ultimate PRO v2.0</strong><br>
          ProfesionÃ¡lnÃ­ sprÃ¡va vodÃ¡renskÃ½ch areÃ¡lÅ¯ s AI asistentem, GPS navigacÃ­ a pokroÄilou analytikou.<br><br>
          <strong>Funkce:</strong><br>
          â€¢ 41 reÃ¡lnÃ½ch areÃ¡lÅ¯ s GPS<br>
          â€¢ Optimalizace tras (TSP)<br>
          â€¢ AI protokoly ÃºdrÅ¾by<br>
          â€¢ Offline reÅ¾im (PWA)<br>
          â€¢ Dark mode<br>
          â€¢ Export dat (CSV)<br><br>
          <strong>Autor:</strong> Dominik Schmied<br>
          <strong>Technologie:</strong> Leaflet.js, Chart.js, AI
        </p>
      </div>
    </div>
    
  </div>
</div>

<!-- Route Modal -->
<div class="modal" id="routeModal">
  <div class="modal-card">
    <div class="modal-header">
      <h3 class="modal-title"><i class="fas fa-route"></i> PlÃ¡novÃ¡nÃ­ trasy</h3>
      <button class="modal-close" onclick="closeRouteModal()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">
        KliknÄ›te na areÃ¡ly na mapÄ› pro pÅ™idÃ¡nÃ­ do trasy. Trasa bude automaticky optimalizovÃ¡na.
      </p>
      <div id="routeSummary" style="background:var(--bg);padding:16px;border-radius:10px;margin-bottom:16px;display:none;">
        <div style="font-size:20px;font-weight:800;color:var(--primary);margin-bottom:8px;">
          <i class="fas fa-road"></i> <span id="routeDistance">0</span> km
        </div>
        <div style="font-size:14px;color:var(--text-muted);">
          <i class="fas fa-clock"></i> OdhadovanÃ½ Äas: <span id="routeTime">0</span> hodin
        </div>
      </div>
      <div class="route-list" id="routeList">
        <p style="text-align:center;color:var(--text-muted);padding:20px;">ZatÃ­m Å¾Ã¡dnÃ© body v trase. KliknÄ›te na areÃ¡ly na mapÄ›.</p>
      </div>
      <div style="margin-top:20px;display:flex;gap:12px;">
        <button class="btn btn-warning" onclick="clearRoute()" style="flex:1;"><i class="fas fa-trash"></i> Vymazat trasu</button>
        <button class="btn btn-success" onclick="optimizeRoute()" style="flex:1;"><i class="fas fa-magic"></i> Optimalizovat</button>
      </div>
    </div>
  </div>
</div>

<!-- AI Modal -->
<div class="modal" id="aiModal">
  <div class="modal-card">
    <div class="modal-header">
      <h3 class="modal-title"><i class="fas fa-robot"></i> AI Protokol ÃºdrÅ¾by</h3>
      <button class="modal-close" onclick="closeAIModal()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px;">
        Generujte AI protokol ÃºdrÅ¾by pro vybranÃ© areÃ¡ly v trase.
      </p>
      <div id="aiResult" style="background:var(--bg);padding:16px;border-radius:10px;white-space:pre-wrap;font-family:monospace;font-size:12px;max-height:400px;overflow-y:auto;display:none;"></div>
      <button class="btn btn-accent" onclick="generateAIProtocol()" id="aiGenBtn">
        <i class="fas fa-magic"></i> Generovat AI Protokol
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.min.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

<script>
// ===== CONFIGURATION =====
const CONFIG = {
  app: { name: "JVS Ultimate PRO", version: "2.0.0" },
  map: { defaultCenter: [49.15, 14.35], defaultZoom: 10, minZoom: 8, maxZoom: 18 },
  routing: { avgSpeed: 50, roadCoefficient: 1.3 },
  storage: { key: "jvs_ultimate_v2" }
};

// ===== DATA - 41 AREÃLÅ® =====
const AREAL_DATA = [
  {"id":1,"nazev":"VDJ Amerika II","okres":"PI","kategorie":"I.","oploceni":293,"vymera":3303,"lat":49.305131,"lon":14.166126},
  {"id":2,"nazev":"VDJ Drahonice","okres":"ST","kategorie":"I.","oploceni":376,"vymera":5953,"lat":49.202902,"lon":14.063713},
  {"id":3,"nazev":"VDJ VodÅˆany","okres":"ST","kategorie":"I.","oploceni":252,"vymera":1594,"lat":49.16455,"lon":14.177836},
  {"id":4,"nazev":"VDJ Hlavatce","okres":"CB","kategorie":"","oploceni":424,"vymera":7968,"lat":49.063584,"lon":14.267751},
  {"id":5,"nazev":"VDJ Å ibeniÄnÃ­ vrch I","okres":"PT","kategorie":"I.","oploceni":245,"vymera":1835,"lat":49.025083,"lon":13.994111},
  {"id":6,"nazev":"ÃšV Husinecka pÅ™ehrada","okres":"PT","kategorie":"","oploceni":703,"vymera":4908,"lat":49.034362,"lon":13.99683},
  {"id":7,"nazev":"VDJ Å ibeniÄnÃ­ vrch II","okres":"PT","kategorie":"I.","oploceni":340,"vymera":3206,"lat":49.02671,"lon":13.994001},
  {"id":8,"nazev":"VDJ ZÃ¡luÅ¾any","okres":"PI","kategorie":"","oploceni":299,"vymera":2350,"lat":49.552857,"lon":14.083381},
  {"id":9,"nazev":"VDJ PtÃ¡ÄnÃ­k","okres":"PT","kategorie":"II.","oploceni":239,"vymera":1070,"lat":49.066147,"lon":14.186844},
  {"id":10,"nazev":"VDJ Zdoba","okres":"CB","kategorie":"II.","oploceni":225,"vymera":15523,"lat":49.212422,"lon":14.338095},
  {"id":11,"nazev":"VDJ Domoradice","okres":"CK","kategorie":"I.","oploceni":450,"vymera":4148,"lat":48.829651,"lon":14.326564},
  {"id":12,"nazev":"VDJ HornÃ­ BrÃ¡na","okres":"CK","kategorie":"I.","oploceni":187,"vymera":1665,"lat":48.80797,"lon":14.329352},
  {"id":13,"nazev":"VDJ NetÅ™ebice","okres":"CK","kategorie":"I.","oploceni":136,"vymera":877,"lat":48.783277,"lon":14.456447},
  {"id":14,"nazev":"VDJ PleÅ¡ivec","okres":"CK","kategorie":"I.","oploceni":119,"vymera":975,"lat":48.802231,"lon":14.304933},
  {"id":15,"nazev":"VDJ Doudleby","okres":"CB","kategorie":"II.","oploceni":79,"vymera":413,"lat":48.888896,"lon":14.480271},
  {"id":16,"nazev":"VDJ Jankov","okres":"CB","kategorie":"I.","oploceni":106,"vymera":784,"lat":48.968747,"lon":14.301697},
  {"id":17,"nazev":"VDJ HosÃ­n II","okres":"CB","kategorie":"I.","oploceni":399,"vymera":4173,"lat":49.030641,"lon":14.501012},
  {"id":18,"nazev":"VDJ Chlum","okres":"CB","kategorie":"II.","oploceni":63,"vymera":535,"lat":49.096493,"lon":14.388679},
  {"id":19,"nazev":"VDJ ChotÃ½Äany","okres":"CB","kategorie":"II.","oploceni":338,"vymera":4775,"lat":49.070748,"lon":14.51946},
  {"id":20,"nazev":"VDJ Rudolfov III","okres":"CB","kategorie":"I.","oploceni":174,"vymera":1868,"lat":48.986207,"lon":14.547076},
  {"id":21,"nazev":"VDJ Rimov - Vesce","okres":"CB","kategorie":"I.","oploceni":99,"vymera":662,"lat":48.847847,"lon":14.466957},
  {"id":22,"nazev":"VDJ Hosin","okres":"CB","kategorie":"II.","oploceni":125,"vymera":809,"lat":49.033641,"lon":14.492878},
  {"id":23,"nazev":"VDJ VÄelnÃ¡","okres":"CB","kategorie":"II.","oploceni":476,"vymera":8660,"lat":48.924663,"lon":14.463506},
  {"id":24,"nazev":"VDJ HÃºry","okres":"CB","kategorie":"I.","oploceni":0,"vymera":395,"lat":49.006417,"lon":14.549815},
  {"id":25,"nazev":"VDJ Chlumec","okres":"CB","kategorie":"II.","oploceni":110,"vymera":811,"lat":49.124766,"lon":14.431321},
  {"id":26,"nazev":"VDJ OleÅ¡nÃ­k","okres":"CB","kategorie":"I.","oploceni":117,"vymera":380,"lat":49.111103,"lon":14.377766},
  {"id":27,"nazev":"ÄŒS Bukovec","okres":"CB","kategorie":"I.","oploceni":300,"vymera":4943,"lat":48.881608,"lon":14.449233},
  {"id":28,"nazev":"VDJ HeÅ™man","okres":"CB","kategorie":"II.","oploceni":119,"vymera":982,"lat":48.909479,"lon":14.499876},
  {"id":29,"nazev":"ÄŒS Vidov u Å™eky","okres":"CB","kategorie":"II.","oploceni":212,"vymera":2501,"lat":48.924157,"lon":14.489619},
  {"id":30,"nazev":"Vrt Vidov","okres":"CB","kategorie":"II.","oploceni":164,"vymera":470,"lat":48.924066,"lon":14.489679},
  {"id":31,"nazev":"ÃšV Plav","okres":"CB","kategorie":"I.","oploceni":1413,"vymera":74777,"lat":48.912611,"lon":14.494018},
  {"id":32,"nazev":"VDJ ÄŒekanice","okres":"TA","kategorie":"I.","oploceni":450,"vymera":6344,"lat":49.422197,"lon":14.689896},
  {"id":33,"nazev":"VDJ SvatÃ¡ Anna","okres":"TA","kategorie":"I.","oploceni":264,"vymera":4192,"lat":49.401133,"lon":14.69864},
  {"id":34,"nazev":"VDJ BezdÄ›ÄÃ­n","okres":"TA","kategorie":"I.","oploceni":169,"vymera":1996,"lat":49.323096,"lon":14.628405},
  {"id":35,"nazev":"VDJ Milevsko","okres":"TA","kategorie":"I.","oploceni":129,"vymera":823,"lat":49.452521,"lon":14.344102},
  {"id":36,"nazev":"VDJ HoduÅ¡Ã­n","okres":"TA","kategorie":"II.","oploceni":205,"vymera":1708,"lat":49.42967,"lon":14.474214},
  {"id":37,"nazev":"VDJ VÅ¡echov","okres":"TA","kategorie":"I.","oploceni":199,"vymera":1574,"lat":49.430159,"lon":14.623205},
  {"id":38,"nazev":"VDJ Zlukov","okres":"TA","kategorie":"II.","oploceni":184,"vymera":1520,"lat":49.196289,"lon":14.736382},
  {"id":39,"nazev":"ÃšV TÃ¡bor","okres":"TA","kategorie":"II.","oploceni":350,"vymera":12262,"lat":49.422872,"lon":14.666426},
  {"id":40,"nazev":"ÄŒS SudomÄ›Å™ice","okres":"TA","kategorie":"I.","oploceni":220,"vymera":2508,"lat":49.28658,"lon":14.547794},
  {"id":41,"nazev":"ProvoznÃ­ Vodojem TÃ¡bor","okres":"TA","kategorie":"II.","oploceni":155,"vymera":1853,"lat":49.413889,"lon":14.659167}
];

// ===== STATE =====
let map, markerCluster, routingControl;
let addMode = false;
let routePoints = [];
let filteredData = [...AREAL_DATA];
let markers = new Map();

// ===== INITIALIZATION =====
function init() {
  initMap();
  renderMarkers();
  populateFilters();
  updateStats();
  loadSavedRoute();
  initEventListeners();
  loadTheme();
  AOS.init({ duration: 600, once: true });
  showToast('JVS Ultimate PRO naÄten', 'success');
}

// ===== MAP =====
function initMap() {
  map = L.map('map', { zoomControl: false }).setView(CONFIG.map.defaultCenter, CONFIG.map.defaultZoom);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap',
    maxZoom: CONFIG.map.maxZoom
  }).addTo(map);
  
  L.control.zoom({ position: 'topright' }).addTo(map);
  
  markerCluster = L.markerClusterGroup({
    maxClusterRadius: 40,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true
  });
  map.addLayer(markerCluster);
  
  map.on('click', onMapClick);
}

function renderMarkers() {
  markerCluster.clearLayers();
  markers.clear();
  
  filteredData.forEach(areal => {
    const color = getMarkerColor(areal);
    const icon = L.divIcon({
      className: 'custom-marker',
      html: `<div style="background:${color};width:30px;height:30px;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3);"></div>`,
      iconSize: [30, 30],
      iconAnchor: [15, 15]
    });
    
    const marker = L.marker([areal.lat, areal.lon], { icon }).bindPopup(createPopup(areal));
    marker.arealData = areal;
    markerCluster.addLayer(marker);
    markers.set(areal.id, marker);
  });
}

function getMarkerColor(areal) {
  if (routePoints.find(r => r.id === areal.id)) return '#7c3aed';
  if (areal.kategorie === 'I.') return '#ef4444';
  if (areal.kategorie === 'II.') return '#f59e0b';
  return '#64748b';
}

function createPopup(areal) {
  const catClass = areal.kategorie === 'I.' ? 'badge-cat-1' : areal.kategorie === 'II.' ? 'badge-cat-2' : 'badge-cat-none';
  const catText = areal.kategorie || 'Bez';
  
  return `
    <div style="min-width:250px;font-family:Inter;">
      <h3 style="font-size:16px;font-weight:800;margin-bottom:8px;color:var(--text-dark);">${areal.nazev}</h3>
      <div style="display:flex;gap:8px;margin-bottom:12px;">
        <span class="badge ${catClass}">${catText}</span>
        <span class="badge" style="background:#e0f2fe;color:#0c4a6e;">${areal.okres}</span>
      </div>
      <div style="font-size:13px;color:var(--text-muted);margin-bottom:12px;">
        <div style="margin-bottom:4px;"><i class="fas fa-ruler-combined"></i> VÃ½mÄ›ra: <strong>${areal.vymera.toLocaleString()} mÂ²</strong></div>
        <div><i class="fas fa-border-all"></i> OplocenÃ­: <strong>${areal.oploceni} bm</strong></div>
      </div>
      <div style="display:flex;gap:8px;">
        <button onclick="addToRoute(${areal.id})" style="flex:1;padding:8px;background:var(--primary);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;">
          <i class="fas fa-route"></i> Do trasy
        </button>
        <button onclick="focusAreal(${areal.id})" style="flex:1;padding:8px;background:var(--success);color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;">
          <i class="fas fa-crosshairs"></i> ZamÄ›Å™it
        </button>
      </div>
    </div>
  `;
}

function onMapClick(e) {
  if (addMode) {
    const lat = e.latlng.lat.toFixed(6);
    const lon = e.latlng.lng.toFixed(6);
    const name = prompt('NÃ¡zev novÃ©ho areÃ¡lu:');
    if (name) {
      const newAreal = {
        id: Date.now(),
        nazev: name,
        okres: 'CB',
        kategorie: 'I.',
        oploceni: 0,
        vymera: 0,
        lat: parseFloat(lat),
        lon: parseFloat(lon)
      };
      AREAL_DATA.push(newAreal);
      filteredData = [...AREAL_DATA];
      renderMarkers();
      updateStats();
      showToast(`AreÃ¡l "${name}" pÅ™idÃ¡n`, 'success');
    }
    toggleAddMode();
  }
}

// ===== ROUTING =====
function addToRoute(id) {
  const areal = AREAL_DATA.find(a => a.id === id);
  if (!areal) return;
  
  if (routePoints.find(r => r.id === id)) {
    showToast('AreÃ¡l uÅ¾ je v trase', 'warning');
    return;
  }
  
  routePoints.push(areal);
  saveRoute();
  renderMarkers();
  updateRouteList();
  showToast(`${areal.nazev} pÅ™idÃ¡n do trasy`, 'success');
}

function removeFromRoute(id) {
  routePoints = routePoints.filter(r => r.id !== id);
  saveRoute();
  renderMarkers();
  updateRouteList();
  showToast('OdstranÄ›no z trasy', 'warning');
}

function clearRoute() {
  routePoints = [];
  saveRoute();
  renderMarkers();
  updateRouteList();
  if (routingControl) {
    map.removeControl(routingControl);
    routingControl = null;
  }
  showToast('Trasa vymazÃ¡na', 'warning');
}

function optimizeRoute() {
  if (routePoints.length < 2) {
    showToast('PÅ™idejte alespoÅˆ 2 areÃ¡ly', 'warning');
    return;
  }
  
  // TSP - Nearest Neighbor Algorithm
  const optimized = [routePoints[0]];
  const remaining = routePoints.slice(1);
  
  while (remaining.length > 0) {
    const current = optimized[optimized.length - 1];
    let nearest = 0;
    let minDist = Infinity;
    
    remaining.forEach((point, idx) => {
      const dist = calcDistance(current.lat, current.lon, point.lat, point.lon);
      if (dist < minDist) {
        minDist = dist;
        nearest = idx;
      }
    });
    
    optimized.push(remaining[nearest]);
    remaining.splice(nearest, 1);
  }
  
  routePoints = optimized;
  saveRoute();
  updateRouteList();
  calculateRoute();
  showToast('Trasa optimalizovÃ¡na!', 'success');
}

function calculateRoute() {
  if (routingControl) {
    map.removeControl(routingControl);
  }
  
  if (routePoints.length < 2) return;
  
  const waypoints = routePoints.map(p => L.latLng(p.lat, p.lon));
  
  routingControl = L.Routing.control({
    waypoints: waypoints,
    routeWhileDragging: false,
    show: false,
    lineOptions: {
      styles: [{ color: '#7c3aed', weight: 6, opacity: 0.8 }]
    },
    createMarker: () => null
  }).addTo(map);
  
  routingControl.on('routesfound', (e) => {
    const routes = e.routes;
    const summary = routes[0].summary;
    const distanceKm = (summary.totalDistance / 1000).toFixed(1);
    const timeHours = (summary.totalTime / 3600).toFixed(1);
    
    document.getElementById('routeDistance').textContent = distanceKm;
    document.getElementById('routeTime').textContent = timeHours;
    document.getElementById('routeSummary').style.display = 'block';
    
    showToast(`Trasa: ${distanceKm} km, ${timeHours} hodin`, 'info');
  });
}

function updateRouteList() {
  const list = document.getElementById('routeList');
  const statsRoute = document.getElementById('statsRoute');
  
  if (routePoints.length === 0) {
    list.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:20px;">ZatÃ­m Å¾Ã¡dnÃ© body v trase.</p>';
    statsRoute.textContent = '0';
    document.getElementById('routeSummary').style.display = 'none';
    return;
  }
  
  statsRoute.textContent = routePoints.length;
  
  list.innerHTML = routePoints.map((point, idx) => `
    <div class="route-item">
      <div class="route-num">${idx + 1}</div>
      <div class="route-info">
        <div class="route-name">${point.nazev}</div>
        <div class="route-meta">${point.okres} â€¢ ${point.vymera.toLocaleString()} mÂ²</div>
      </div>
      <div class="route-actions">
        <button class="route-btn" onclick="removeFromRoute(${point.id})" title="Odstranit">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  `).join('');
}

// ===== AI PROTOCOL =====
function generateAIProtocol() {
  if (routePoints.length === 0) {
    showToast('PÅ™idejte areÃ¡ly do trasy', 'warning');
    return;
  }
  
  const btn = document.getElementById('aiGenBtn');
  btn.innerHTML = '<span class="loading-spinner"></span> Generuji...';
  btn.disabled = true;
  
  setTimeout(() => {
    const protocol = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI PROTOKOL ÃšDRÅ½BY - JVS ULTIMATE PRO v2.0
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Datum: ${new Date().toLocaleDateString('cs-CZ')}
ğŸ”§ Technik: [Doplnit jmÃ©no]
ğŸ“ PoÄet areÃ¡lÅ¯: ${routePoints.length}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Š SOUHRNNÃ‰ ÃšDAJE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

CelkovÃ¡ vÃ½mÄ›ra: ${routePoints.reduce((sum, p) => sum + p.vymera, 0).toLocaleString()} mÂ²
CelkovÃ© oplocenÃ­: ${routePoints.reduce((sum, p) => sum + p.oploceni, 0).toLocaleString()} bm
OdhadovanÃ½ Äas prÃ¡ce: ${(routePoints.length * 0.5).toFixed(1)} hodin

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“‹ CHECKLIST AREÃLÅ® (${routePoints.length})
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

${routePoints.map((p, idx) => `
${idx + 1}. ${p.nazev}
   â€¢ Okres: ${p.okres}
   â€¢ Kategorie: ${p.kategorie || 'Bez'}
   â€¢ VÃ½mÄ›ra: ${p.vymera.toLocaleString()} mÂ²
   â€¢ OplocenÃ­: ${p.oploceni} bm
   â€¢ GPS: ${p.lat.toFixed(5)}, ${p.lon.toFixed(5)}
   
   Ãškoly:
   â˜ VizuÃ¡lnÃ­ kontrola vstupÅ¯
   â˜ SekÃ¡nÃ­ trÃ¡vy (${(p.vymera / 1000 * 0.5).toFixed(1)} hodin)
   â˜ Kontrola oplocenÃ­
   â˜ ÃšdrÅ¾ba zÃ¡mkÅ¯ a zabezpeÄenÃ­
   â˜ Fotodokumentace stavu
   â˜ ZÃ¡pis do protokolu
`).join('\n')}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ BEZPEÄŒNOSTNÃ OPATÅ˜ENÃ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â˜ OsobnÃ­ ochrannÃ© pomÅ¯cky (OOP)
â˜ UzamknutÃ­ areÃ¡lu po dokonÄenÃ­
â˜ HlÃ¡Å¡enÃ­ problÃ©mÅ¯ dispeÄinku
â˜ Fotodokumentace kritickÃ½ch nÃ¡lezÅ¯

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ POZNÃMKY TECHNIKA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[VolnÃ© mÃ­sto pro poznÃ¡mky]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Podpis technika: _________________  Datum: _________
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;
    
    document.getElementById('aiResult').textContent = protocol;
    document.getElementById('aiResult').style.display = 'block';
    
    btn.innerHTML = '<i class="fas fa-magic"></i> Generovat AI Protokol';
    btn.disabled = false;
    
    showToast('AI protokol vygenerovÃ¡n', 'success');
  }, 1500);
}

// ===== FILTERS =====
function populateFilters() {
  const okresy = [...new Set(AREAL_DATA.map(a => a.okres))].sort();
  const districtFilter = document.getElementById('districtFilter');
  okresy.forEach(okres => {
    const opt = document.createElement('option');
    opt.value = okres;
    opt.textContent = okres;
    districtFilter.appendChild(opt);
  });
}

function applyFilters() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const district = document.getElementById('districtFilter').value;
  const category = document.getElementById('categoryFilter').value;
  
  filteredData = AREAL_DATA.filter(a => {
    const matchSearch = a.nazev.toLowerCase().includes(search);
    const matchDistrict = !district || a.okres === district;
    const matchCategory = !category || (category === 'none' ? !a.kategorie : a.kategorie === category);
    return matchSearch && matchDistrict && matchCategory;
  });
  
  renderMarkers();
  updateStats();
}

function resetFilters() {
  document.getElementById('searchInput').value = '';
  document.getElementById('districtFilter').value = '';
  document.getElementById('categoryFilter').value = '';
  filteredData = [...AREAL_DATA];
  renderMarkers();
  updateStats();
  showToast('Filtry resetovÃ¡ny', 'info');
}

// ===== STATS =====
function updateStats() {
  const totalArea = filteredData.reduce((sum, a) => sum + a.vymera, 0);
  const totalFence = filteredData.reduce((sum, a) => sum + a.oploceni, 0);
  
  document.getElementById('statsTotal').textContent = filteredData.length;
  document.getElementById('statsArea').textContent = Math.round(totalArea / 1000) + 'k';
  document.getElementById('statsFence').textContent = Math.round(totalFence / 1000) + 'k';
  document.getElementById('statsRoute').textContent = routePoints.length;
  
  document.getElementById('statTotalAreas').textContent = filteredData.length;
  document.getElementById('statTotalArea').textContent = Math.round(totalArea / 1000) + 'k';
  document.getElementById('statTotalFence').textContent = Math.round(totalFence / 1000) + 'k';
  document.getElementById('statFiltered').textContent = filteredData.length;
}

// ===== UTILITIES =====
function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon/2) * Math.sin(dLon/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

function showToast(message, type = 'info') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
    <span>${message}</span>
  `;
  container.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

// ===== STORAGE =====
function saveRoute() {
  localStorage.setItem(CONFIG.storage.key + '_route', JSON.stringify(routePoints));
}

function loadSavedRoute() {
  const saved = localStorage.getItem(CONFIG.storage.key + '_route');
  if (saved) {
    routePoints = JSON.parse(saved);
    updateRouteList();
  }
}

function clearStorage() {
  if (confirm('Opravdu vymazat vÅ¡echna uloÅ¾enÃ¡ data?')) {
    localStorage.clear();
    routePoints = [];
    updateRouteList();
    renderMarkers();
    showToast('Data vymazÃ¡na', 'warning');
  }
}

// ===== THEME =====
function toggleTheme() {
  const html = document.documentElement;
  const currentTheme = html.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  html.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  
  const icon = document.querySelector('.theme-fab i');
  icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
  
  const metaTheme = document.getElementById('themeColorMeta');
  metaTheme.content = newTheme === 'dark' ? '#0f172a' : '#0055ff';
  
  showToast(`TÃ©ma: ${newTheme === 'dark' ? 'TmavÃ©' : 'SvÄ›tlÃ©'}`, 'info');
}

function loadTheme() {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  const icon = document.querySelector('.theme-fab i');
  icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
}

// ===== GPS =====
function locateUser() {
  const btn = document.getElementById('gpsFab');
  btn.classList.add('active');
  
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      map.setView([pos.coords.latitude, pos.coords.longitude], 14);
      L.marker([pos.coords.latitude, pos.coords.longitude])
        .addTo(map)
        .bindPopup('VaÅ¡e poloha')
        .openPopup();
      showToast('Poloha nalezena', 'success');
      setTimeout(() => btn.classList.remove('active'), 2000);
    },
    (err) => {
      showToast('Chyba GPS: ' + err.message, 'error');
      btn.classList.remove('active');
    }
  );
}

function focusAreal(id) {
  const areal = AREAL_DATA.find(a => a.id === id);
  if (areal) {
    map.setView([areal.lat, areal.lon], 16);
    const marker = markers.get(id);
    if (marker) marker.openPopup();
  }
}

// ===== EXPORT =====
function exportCSV() {
  const csv = [
    ['ID','NÃ¡zev','Okres','Kategorie','VÃ½mÄ›ra (mÂ²)','OplocenÃ­ (bm)','Lat','Lon'],
    ...filteredData.map(a => [a.id, a.nazev, a.okres, a.kategorie, a.vymera, a.oploceni, a.lat, a.lon])
  ].map(row => row.join(';')).join('\n');
  
  const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `jvs_arealy_${new Date().toISOString().split('T')[0]}.csv`;
  link.click();
  URL.revokeObjectURL(url);
  
  showToast('CSV exportovÃ¡no', 'success');
}

// ===== UI CONTROLS =====
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('active');
}

function togglePanel(el) {
  el.parentElement.classList.toggle('open');
}

function toggleAddMode() {
  addMode = !addMode;
  const fab = document.getElementById('addFab');
  fab.classList.toggle('active');
  showToast(addMode ? 'ReÅ¾im pÅ™idÃ¡vÃ¡nÃ­ aktivnÃ­' : 'ReÅ¾im pÅ™idÃ¡vÃ¡nÃ­ ukonÄen', addMode ? 'success' : 'warning');
}

function openRouteModal() {
  document.getElementById('routeModal').classList.add('active');
  updateRouteList();
}

function closeRouteModal() {
  document.getElementById('routeModal').classList.remove('active');
}

function openAIModal() {
  document.getElementById('aiModal').classList.add('active');
}

function closeAIModal() {
  document.getElementById('aiModal').classList.remove('active');
}

// ===== EVENT LISTENERS =====
function initEventListeners() {
  document.getElementById('searchInput').addEventListener('input', applyFilters);
  document.getElementById('districtFilter').addEventListener('change', applyFilters);
  document.getElementById('categoryFilter').addEventListener('change', applyFilters);
  
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.metaKey) {
      if (e.key === 'f') {
        e.preventDefault();
        document.getElementById('searchInput').focus();
      } else if (e.key === 'r') {
        e.preventDefault();
        resetFilters();
      } else if (e.key === 'e') {
        e.preventDefault();
        exportCSV();
      } else if (e.key === 'p') {
        e.preventDefault();
        openAIModal();
      }
    } else if (e.key === 'Escape') {
      closeRouteModal();
      closeAIModal();
    }
  });
}

// ===== START =====
window.addEventListener('load', init);
</script>

</body>
</html>
