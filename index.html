<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0055ff">
    <meta name="description" content="JVS Management System - Profesion√°ln√≠ spr√°va 41 vod√°rensk√Ωch are√°l≈Ø Jihoƒçesk√©ho kraje">
    
    <title>JVS Management System</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="./src/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./src/assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./src/assets/icons/apple-touch-icon.png">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0055ff',
                        'primary-light': '#4c8cff',
                        'primary-dark': '#0044cc',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Leaflet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js" defer></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="./src/assets/css/main.css">
    <link rel="stylesheet" href="./src/assets/css/components.css">
    <link rel="stylesheet" href="./src/assets/css/map.css">
    <link rel="stylesheet" href="./src/assets/css/animations.css">
</head>
<body class="font-sans bg-gray-100 overflow-hidden">
    
    <!-- Main Map Container -->
    <div id="mapContainer" class="w-full h-screen relative">
        <div id="map" class="w-full h-full"></div>
        
        <!-- Map Loading Overlay -->
        <div id="mapLoading" class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center z-50">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
                <p class="text-gray-600">Naƒç√≠t√°n√≠ mapy...</p>
            </div>
        </div>
    </div>
    
    <!-- Sidebar Panel -->
    <aside id="sidebar" class="sidebar-container">
        <div class="glass-panel">
            
            <!-- Header Section -->
            <header class="sidebar-header">
                <div class="brand-section">
                    <div class="logo-wrapper">
                        <div class="logo-circle">JVS</div>
                        <div class="brand-info">
                            <h1 class="brand-title">JVS Manager</h1>
                            <p class="brand-subtitle">Syst√©m spr√°vy are√°l≈Ø</p>
                        </div>
                    </div>
                    <button id="sidebarToggle" class="sidebar-toggle" aria-label="Zav≈ô√≠t/Otev≈ô√≠t panel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Quick Stats -->
                <div id="quickStats" class="quick-stats">
                    <div class="stat-item">
                        <span class="stat-value">41</span>
                        <span class="stat-label">Are√°l≈Ø</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="completedCount">0</span>
                        <span class="stat-label">Dokonƒçeno</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="highRiskCount">0</span>
                        <span class="stat-label">Vysok√© riziko</span>
                    </div>
                </div>
            </header>
            
            <!-- Navigation Menu -->
            <nav class="sidebar-nav">
                
                <!-- Statistics Section -->
                <section class="nav-section">
                    <button class="section-trigger" data-target="statsSection" aria-expanded="false">
                        <span class="section-icon">
                            <i class="fas fa-chart-line"></i>
                        </span>
                        <span class="section-title">P≈ôehled statistik</span>
                        <i class="chevron fas fa-chevron-down"></i>
                    </button>
                    <div id="statsSection" class="section-content">
                        <div id="detailedStats" class="stats-grid"></div>
                        <div class="export-actions">
                            <button id="exportCSV" class="export-btn">
                                <i class="fas fa-file-csv"></i>
                                Export CSV
                            </button>
                            <button id="exportGeoJSON" class="export-btn">
                                <i class="fas fa-map"></i>
                                Export GeoJSON
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Filters Section -->
                <section class="nav-section">
                    <button class="section-trigger" data-target="filtersSection" aria-expanded="false">
                        <span class="section-icon">
                            <i class="fas fa-filter"></i>
                        </span>
                        <span class="section-title">Filtry a vyhled√°v√°n√≠</span>
                        <i class="chevron fas fa-chevron-down"></i>
                    </button>
                    <div id="filtersSection" class="section-content">
                        
                        <!-- Search Input -->
                        <div class="form-group">
                            <label for="searchInput" class="form-label">Vyhled√°v√°n√≠</label>
                            <div class="search-wrapper">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" 
                                       id="searchInput" 
                                       class="form-input search-input" 
                                       placeholder="Hledat are√°l, mƒõsto, okres...">
                                <button id="clearSearch" class="clear-search hidden">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Category Filters -->
                        <div class="form-group">
                            <label class="form-label">Kategorie rizika</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="catI" name="category" value="I." checked>
                                    <label for="catI" class="checkbox-label">
                                        <span class="risk-indicator high"></span>
                                        Kategorie I. (Vysok√© riziko)
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="catII" name="category" value="II." checked>
                                    <label for="catII" class="checkbox-label">
                                        <span class="risk-indicator medium"></span>
                                        Kategorie II. (St≈ôedn√≠ riziko)
                                    </label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="catNone" name="category" value="" checked>
                                    <label for="catNone" class="checkbox-label">
                                        <span class="risk-indicator low"></span>
                                        Bez kategorie (Standardn√≠)
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Risk Slider -->
                        <div class="form-group">
                            <label class="form-label">Minim√°ln√≠ riziko √∫dr≈æby</label>
                            <div class="range-wrapper">
                                <input type="range" 
                                       id="riskSlider" 
                                       class="form-range" 
                                       min="0" 
                                       max="100" 
                                       value="0">
                                <div class="range-labels">
                                    <span>0%</span>
                                    <span id="riskValue" class="risk-value">0%</span>
                                    <span>100%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- District Filter -->
                        <div class="form-group">
                            <label for="districtFilter" class="form-label">Okres</label>
                            <select id="districtFilter" class="form-select">
                                <option value="">V≈°echny okresy</option>
                                <option value="CB">ƒåesk√© Budƒõjovice</option>
                                <option value="TA">T√°bor</option>
                                <option value="PT">Prachatice</option>
                                <option value="CK">ƒåesk√Ω Krumlov</option>
                                <option value="PI">P√≠sek</option>
                                <option value="ST">Strakonice</option>
                            </select>
                        </div>
                        
                        <!-- Filter Actions -->
                        <div class="filter-actions">
                            <button id="applyFilters" class="btn btn-primary">
                                <i class="fas fa-check"></i>
                                Pou≈æ√≠t filtry
                            </button>
                            <button id="resetFilters" class="btn btn-secondary">
                                <i class="fas fa-undo"></i>
                                Resetovat
                            </button>
                        </div>
                        
                    </div>
                </section>
                
                <!-- Areals List Section -->
                <section class="nav-section">
                    <button class="section-trigger" data-target="arealsSection" aria-expanded="false">
                        <span class="section-icon">
                            <i class="fas fa-list"></i>
                        </span>
                        <span class="section-title">Seznam are√°l≈Ø (<span id="arealsCount">41</span>)</span>
                        <i class="chevron fas fa-chevron-down"></i>
                    </button>
                    <div id="arealsSection" class="section-content">
                        <div id="arealsList" class="areals-list"></div>
                        <div id="emptyState" class="empty-state hidden">
                            <i class="fas fa-search"></i>
                            <p>≈Ω√°dn√© are√°ly neodpov√≠daj√≠ zvolen√Ωm filtr≈Øm.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Route Planner Section -->
                <section class="nav-section">
                    <button class="section-trigger" data-target="routeSection" aria-expanded="false">
                        <span class="section-icon">
                            <i class="fas fa-route"></i>
                        </span>
                        <span class="section-title">Pl√°novaƒç tras (<span id="routeCount">0</span>)</span>
                        <i class="chevron fas fa-chevron-down"></i>
                    </button>
                    <div id="routeSection" class="section-content">
                        <div class="route-info">
                            <p class="text-sm text-gray-600 mb-4">
                                Vyberte are√°ly kliknut√≠m na mapu nebo pomoc√≠ tlaƒç√≠tka <i class="fas fa-plus-circle text-primary"></i>. 
                                Maxim√°lnƒõ 10 bod≈Ø.
                            </p>
                        </div>
                        
                        <div id="routePoints" class="route-points mb-4"></div>
                        
                        <div class="route-actions">
                            <button id="calculateRoute" class="btn btn-warning" disabled>
                                <i class="fas fa-calculator"></i>
                                Vypoƒç√≠tat trasu
                            </button>
                            <button id="clearRoute" class="btn btn-secondary" disabled>
                                <i class="fas fa-trash"></i>
                                Smazat body
                            </button>
                        </div>
                        
                        <div id="routeResult" class="route-result mt-4 hidden">
                            <div class="route-summary">
                                <div class="summary-item">
                                    <span class="summary-label">Celkov√° vzd√°lenost:</span>
                                    <span id="routeDistance" class="summary-value">-</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">Odhadovan√Ω ƒças:</span>
                                    <span id="routeDuration" class="summary-value">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
            </nav>
        </div>
    </aside>
    
    <!-- Map Controls -->
    <div class="map-controls">
        <button id="toggleSidebar" class="control-btn" aria-label="Otev≈ô√≠t/Zav≈ô√≠t panel">
            <i class="fas fa-bars"></i>
        </button>
        <button id="toggleAI" class="control-btn ai-toggle" aria-label="AI Asistent">
            <i class="fas fa-robot"></i>
        </button>
        <button id="locateUser" class="control-btn" aria-label="M≈Øj poloha">
            <i class="fas fa-crosshairs"></i>
        </button>
        <button id="resetMapView" class="control-btn" aria-label="Reset zobrazen√≠">
            <i class="fas fa-home"></i>
        </button>
    </div>
    
    <!-- AI Chat Panel -->
    <div id="aiPanel" class="ai-panel">
        <div class="ai-header">
            <div class="ai-title">
                <i class="fas fa-robot"></i>
                <span>JVS AI Asistent</span>
            </div>
            <button id="closeAI" class="ai-close" aria-label="Zav≈ô√≠t AI">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="aiMessages" class="ai-messages">
            <div class="ai-message bot">
                <div class="message-content">
                    <p><strong>V√≠tejte v JVS AI Asistentovi!</strong></p>
                    <p>Jsem zde, abych v√°m pomohl se spr√°vou vod√°rensk√Ωch are√°l≈Ø. M≈Ø≈æu v√°m pomoci s:</p>
                    <ul>
                        <li>üîç Vyhled√°v√°n√≠m are√°l≈Ø pomoc√≠ p≈ôirozen√©ho jazyka</li>
                        <li>üó∫Ô∏è Optimalizac√≠ tras a navigac√≠</li>
                        <li>üìä Anal√Ωzou dat a statistik</li>
                        <li>‚ö†Ô∏è Predikc√≠ rizik a √∫dr≈æby</li>
                    </ul>
                    <p><strong>Zkuste nap≈ô.:</strong> "Najdi v≈°echny are√°ly kategorie I. v T√°bo≈ôe s vysok√Ωm rizikem √∫dr≈æby"</p>
                </div>
            </div>
        </div>
        
        <div class="ai-input-section">
            <div class="ai-input-wrapper">
                <input type="text" 
                       id="aiInput" 
                       class="ai-input" 
                       placeholder="Zadejte dotaz nebo po≈æadavek...">
                <button id="sendAI" class="ai-send">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="ai-status" id="aiStatus"></div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="arealModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detail are√°lu</h3>
                <button id="closeModal" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modalBody" class="modal-body">
                <!-- Content will be dynamically loaded -->
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Loading Indicator -->
    <div id="globalLoader" class="global-loader hidden">
        <div class="loader-content">
            <div class="spinner"></div>
            <p id="loaderText">Naƒç√≠t√°n√≠...</p>
        </div>
    </div>
    
    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registrov√°n', reg))
                .catch(err => console.error('Chyba p≈ôi registraci Service Worker:', err));
        }
    </script>
    
    <!-- Application Scripts -->
    <script src="./src/services/data.service.js" type="module"></script>
    <script src="./src/services/map.service.js" type="module"></script>
    <script src="./src/services/ai.service.js" type="module"></script>
    <script src="./src/modules/filters.module.js" type="module"></script>
    <script src="./src/modules/routes.module.js" type="module"></script>
    <script src="./src/modules/ui.module.js" type="module"></script>
    <script src="./src/components/modal.component.js" type="module"></script>
    <script src="./src/components/toast.component.js" type="module"></script>
    <script src="./src/app.js" type="module"></script>
    
</body>
</html
